# When a branch matching bot/* or cursor-agent/* is pushed, open a PR to the default branch
# if one doesn't already exist. Useful when Cursor Cloud Agent only pushes a branch.
name: Auto PR for bot/cursor branches

on:
  push:
    branches:
      - "bot/**"
      - "cursor-agent/**"

permissions:
  contents: read
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create PR from current branch
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          BRANCH="${{ github.ref_name }}"
          BASE="${{ github.event.repository.default_branch }}"
          if [ "$BRANCH" = "$BASE" ]; then exit 0; fi
          if gh pr list --head "$BRANCH" --state open --json number --jq 'length' | grep -q '^[1-9]'; then
            echo "PR already exists for $BRANCH"
            exit 0
          fi
          gh pr create --base "$BASE" --head "$BRANCH" \
            --title "[Bot] $BRANCH" \
            --body "Auto-generated PR from branch \`$BRANCH\`. Review and merge when ready."
